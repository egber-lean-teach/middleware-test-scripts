import { ITokenCounts } from "../interfaces/tokenCounts";
import { logger } from "../models/Logger";
import { safeExtract } from "./safeExtract";

export function extractGoogleAITokenCounts(response: any): ITokenCounts {
  console.log;
  try {
    const usageMetadata = response.usage || (response as any).response?.usage;
    if (!usageMetadata)
      return { inputTokens: 0, outputTokens: 0, totalTokens: 0 };

    const inputTokens = safeExtract.number(usageMetadata, "prompt_tokens");
    const outputTokens = safeExtract.number(usageMetadata, "completion_tokens");
    const totalTokens = safeExtract.number(usageMetadata, "total_tokens");
    return {
      inputTokens,
      outputTokens,
      totalTokens,
      cachedTokens: 0,
      reasoningTokens: 0,
    };
  } catch (error) {
    logger.warning("Failed to extract Google AI token counts:", error);
    return { inputTokens: 0, outputTokens: 0, totalTokens: 0 };
  }
}
